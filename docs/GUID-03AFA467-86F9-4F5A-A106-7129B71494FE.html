<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="TCPIP_IPV6_UniqueLocalUnicastAddressAdd Function" />
<meta name="DC.relation" scheme="URI" content="GUID-F2484EF9-7914-43EE-A5B7-4FFDC27C8135.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="tcpip-ipv6-uniquelocalunicastaddressadd-function" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>TCPIP_IPV6_UniqueLocalUnicastAddressAdd Function</title>
<meta name="Microsoft.Help.Id" content="GUID-B1AF6B2B-BC62-4D92-B329-A50140DF3437-tcpip-ipv6-uniquelocalunicastaddressadd-function" />
<meta name="Microsoft.Help.TocParent" content="GUID-B1AF6B2B-BC62-4D92-B329-A50140DF3437" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony TCP/IP Library Reference A 10/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-03AFA467-86F9-4F5A-A106-7129B71494FE"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="tcpip-ipv6-uniquelocalunicastaddressadd-function">
<h1 class="title topictitle1" id="ariaid-title1">TCPIP_IPV6_UniqueLocalUnicastAddressAdd Function</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-F2484EF9-7914-43EE-A5B7-4FFDC27C8135.html">IPv6 Module</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock"><button title="Copy Code" class="copy-code" onclick="cpy('d221746e21', this);">Copy</button><code id="d221746e21" content="IPV6_ULA_RESULT TCPIP_IPV6_UniqueLocalUnicastAddressAdd(&#xD;&#xA;    TCPIP_NET_HANDLE netH, &#xD;&#xA;    uint16_t subnetID, &#xD;&#xA;    IPV6_ULA_FLAGS genFlags, &#xD;&#xA;    IP_MULTI_ADDRESS* ntpAddress&#xD;&#xA;);&#xD;">IPV6_ULA_RESULT TCPIP_IPV6_UniqueLocalUnicastAddressAdd(&#xD;
    TCPIP_NET_HANDLE netH, &#xD;
    uint16_t subnetID, &#xD;
    IPV6_ULA_FLAGS genFlags, &#xD;
    IP_MULTI_ADDRESS* ntpAddress&#xD;
);&#xD;</code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="description"><h2 class="title topictitle2" id="ariaid-title3">Description</h2><div class="body"><p class="p">This function starts the process of adding a ULA address to the specified interface. The segments of the generated address are as follows:</p>
<ul class="ul"><li class="li"><p class="p">FC00::/7 - ULA prefix</p>
</li>
<li class="li"><p class="p">L - 1 bit set to 1, locally assigned</p>
</li>
<li class="li"><p class="p">Global ID - 40 bit random generated identifier</p>
</li>
<li class="li"><p class="p">subnet ID - 16 bit subnet identifier</p>
</li>
<li class="li"><p class="p">Interface ID - 64 bit interface identifier generated as a EUI64 from the specified interface MAC</p>
</li>
</ul>
<p class="p">The randomness of the "Global ID" prefix of the generated IPv6 address is obtained by using an NTP server. The supplied NTP server will be contacted to obtain an NTP time stamp. This time stamp together with the EUI64 identifier obtained from the interface MAC are passed through a 160 bits hash algorithm (SHA1) and the least significant 40 bits are used as the GlobalID of the interface.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="preconditions"><h2 class="title topictitle2" id="ariaid-title4">Preconditions</h2><div class="body"><p class="p">The IPv6 stack is initialized and the interface is up and configured.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="parameters"><h2 class="title topictitle2" id="ariaid-title5">Parameters</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d221746e63"><span>Parameters</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d221746e65"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d221746e63 "><span>netH</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d221746e65 "><span>The interface to add the address to.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d221746e63 "><span>subnetIP</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d221746e65 "><span>The subnet ID to be used.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d221746e63 "><span>genFlags</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d221746e65 "><span>Address generation flags:- IPV6_ULA_FLAG_NTPV4 - if set, the NTP server will be contacted over an IPv4 connection. Otherwise, a default IPv6 connection will be attempted.- IPV6_ULA_FLAG_GENERATE_ONLY - if set, the address will not be added to the list of the addresses for the specified interface. -  IPV6_ULA_FLAG_SKIP_DAD - if set, the DAD processing will be skipped.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d221746e63 "><span>ntpAddress</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d221746e65 "><span>The NTP server address - it is an IPv4/IPv6 address as selected by the IPV6_ULA_FLAG_NTPV4 flag (the IP address could be obtained with an DNS call into the stack). Not currently used.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="returns"><h2 class="title topictitle2" id="ariaid-title6">Returns</h2><div class="body"><ul class="ul"><li class="li"><p class="p">IPV6_ULA_RES_BUSY - address generation module is busy.</p>
</li>
<li class="li"><p class="p">IPV6_ULA_RES_IF_ERR - IPv6 interface is not up.</p>
</li>
<li class="li"><p class="p">IPV6_ULA_RES_OK - if the call succeeded and the generation process was started.</p>
</li>
</ul>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="remarks"><h2 class="title topictitle2" id="ariaid-title7">Remarks</h2><div class="body"><p class="p">ULA generation needs to be enabled in the stack at build time.</p>
<p class="p">Only one address generation at a time is supported for now. Before attempting a new address generation the previous operation has to be completed, otherwise the call will fail.</p>
<p class="p">This function requires that the NTP client is enabled in the stack. If not, the call will fail.</p>
<p class="p">The caller will be notified by the outcome of the operation by the stack using the standard IPv6 notification handler (registered by TCPIP_IPV6_HandlerRegister() call).</p>
<p class="p">The <em class="ph i">ntpAddress</em> parameter is not currently used. The NTP timestamp will be obtained using the default NTP server address.</p>
</div>
</div>
</body>
</html>