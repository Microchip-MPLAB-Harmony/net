<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="_tag_MAC_DATA_SEGMENT Structure" />
<meta name="DC.relation" scheme="URI" content="GUID-0C1AF471-66D4-472F-84AF-212E9E18B21D.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="-tag-mac-data-segment-structure" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>_tag_MAC_DATA_SEGMENT Structure</title>
<meta name="Microsoft.Help.Id" content="GUID-B1AF6B2B-BC62-4D92-B329-A50140DF3437--tag-mac-data-segment-structure" />
<meta name="Microsoft.Help.TocParent" content="GUID-B1AF6B2B-BC62-4D92-B329-A50140DF3437" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony TCP/IP Library Reference A 10/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-F1036B24-FE86-4897-BC92-70F7118DECB1"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="-tag-mac-data-segment-structure">
<h1 class="title topictitle1" id="ariaid-title1">_tag_MAC_DATA_SEGMENT Structure</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-0C1AF471-66D4-472F-84AF-212E9E18B21D.html">MAC Driver Module</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock"><button title="Copy Code" class="copy-code" onclick="cpy('d278931e21', this);">Copy</button><code id="d278931e21" content="struct _tag_MAC_DATA_SEGMENT {&#xD;&#xA;struct _tag_MAC_DATA_SEGMENT* next;&#xD;&#xA;uint8_t* segLoad;&#xD;&#xA;uint16_t segLen;&#xD;&#xA;uint16_t segSize;&#xD;&#xA;uint16_t segFlags;&#xD;&#xA;uint16_t segLoadOffset;&#xD;&#xA;uint16_t segAllocSize;&#xD;&#xA;uint8_t segClientData[2];&#xD;&#xA;};&#xD;">struct _tag_MAC_DATA_SEGMENT {&#xD;
struct _tag_MAC_DATA_SEGMENT* next;&#xD;
uint8_t* segLoad;&#xD;
uint16_t segLen;&#xD;
uint16_t segSize;&#xD;
uint16_t segFlags;&#xD;
uint16_t segLoadOffset;&#xD;
uint16_t segAllocSize;&#xD;
uint8_t segClientData[2];&#xD;
};&#xD;</code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="description"><h2 class="title topictitle2" id="ariaid-title3">Description</h2><div class="body"><p class="p">TCPIP MAC Data Segment.</p>
<p class="p">Structure of a segment buffer transferred with the MAC. A MAC TX or RX packet can consist of multiple data segments. On TX the MAC has to be able to transmit packets that span multiple data segments. On RX of a network frame the MAC may have to use multiple segments to construct a packet. (For performance reasons, a contiguous MAC packet, with just one segment, if possible, is preferred).</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="members"><h2 class="title topictitle2" id="ariaid-title4">Members</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d278931e41"><span>Members</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d278931e43"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e41 "><span>next</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e43 "><span>Multi-segment support, next segment in the chain.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e41 "><span>segLoad</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e43 "><span>Pointer to segment data payload Points to TCPIP_MAC_SEGMENT_PAYLOAD::segmentPayload. It specifies the address of the 1st payload byte. If the processor has cache, then it is always cache line size aligned. Otherwise is 32 bits aligned.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e41 "><span>segLen</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e43 "><span>Segment payload size; TX: Number of bytes from this segment that has to be transmitted. This is the total number of bytes including the Ethernet header but not the FCS (that should be added by the driver) RX: Number of payload bytes in the segment. The MAC driver subtracts the FCS and Ethernet header length before handing over the packet to the stack. Then the segLen field is updated by each stack layer in turn.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e41 "><span>segSize</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e43 "><span>Segment allocated total usable size. This does not include the segLoadOffset (see below).</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e41 "><span>segFlags</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e43 "><span>TCPIP_MAC_SEGMENT_FLAGS segment flags: TCPIP_MAC_SEG_FLAG_STATIC, TCPIP_MAC_SEG_FLAG_RX, TCPIP_MAC_SEG_FLAG_RX, TCPIP_MAC_SEG_FLAG_RX_STICKY.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e41 "><span>segLoadOffset</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e43 "><span>Offset in bytes between the address pointed by segLoad and the address where the segment buffer starts/was allocated. It specifies the gap space at the beginning of the TCPIP_MAC_SEGMENT_PAYLOAD before the segmentPayload begins. segLoadOffset == sizeof(TCPIP_MAC_SEGMENT_PAYLOAD::segmentPktPtr) + sizeof(TCPIP_MAC_SEGMENT_PAYLOAD::segmentDataGap). This currently is greater or equal than 8 bytes depending on the MAC drivers that are part of the build! See TCPIP_MAC_DATA_SEGMENT. For implementations that may work outside the Harmony TCP/IP stack it is up to the MAC to check that the value of this offset is enforced.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e41 "><span>segAllocSize</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e43 "><span>The size this segment payload allocation. Debug/trace purposes.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e41 "><span>segClientData[2]</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d278931e43 "><span>Additional client segment data. Ignored by the MAC driver.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="remarks"><h2 class="title topictitle2" id="ariaid-title5">Remarks</h2><div class="body"><p class="p">See notes for the segLoadOffset member. On 32-bit machines, the segment payload is allocated so that it is always cache line size aligned and its size is 32-bits multiple.</p>
</div>
</div>
</body>
</html>