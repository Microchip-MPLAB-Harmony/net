<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="TCPIP_ICMP_EchoRequest Function" />
<meta name="DC.relation" scheme="URI" content="GUID-F3E078F7-6F1D-4D25-A999-F0F3E40A5971.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="tcpip-icmp-echorequest-function" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>TCPIP_ICMP_EchoRequest Function</title>
<meta name="Microsoft.Help.Id" content="GUID-B1AF6B2B-BC62-4D92-B329-A50140DF3437-tcpip-icmp-echorequest-function" />
<meta name="Microsoft.Help.TocParent" content="GUID-B1AF6B2B-BC62-4D92-B329-A50140DF3437" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony TCP/IP Library Reference A 10/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-16262C6E-46B3-47F5-A6DB-23BC83862AAF"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="tcpip-icmp-echorequest-function">
<h1 class="title topictitle1" id="ariaid-title1">TCPIP_ICMP_EchoRequest Function</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-F3E078F7-6F1D-4D25-A999-F0F3E40A5971.html">ICMP Module</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock"><button title="Copy Code" class="copy-code" onclick="cpy('d40546e21', this);">Copy</button><code id="d40546e21" content="ICMP_ECHO_RESULT TCPIP_ICMP_EchoRequest(&#xD;&#xA;    TCPIP_ICMP_ECHO_REQUEST* pEchoRequest, &#xD;&#xA;    TCPIP_ICMP_REQUEST_HANDLE* pHandle&#xD;&#xA;);&#xD;">ICMP_ECHO_RESULT TCPIP_ICMP_EchoRequest(&#xD;
    TCPIP_ICMP_ECHO_REQUEST* pEchoRequest, &#xD;
    TCPIP_ICMP_REQUEST_HANDLE* pHandle&#xD;
);&#xD;</code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="description"><h2 class="title topictitle2" id="ariaid-title3">Description</h2><div class="body"><p class="p">This function allows a stack client to send an ICMP query message to a remote host. The supplied sequence number and identifier will be used in the query message. The request will also contain user supplied data. The request is scheduled and the user will be notified of the outcome of the query using the callback function that's specified in the call.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="preconditions"><h2 class="title topictitle2" id="ariaid-title4">Preconditions</h2><div class="body"><p class="p">The TCP/IP Stack must be initialized and up and running.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="returns"><h2 class="title topictitle2" id="ariaid-title5">Returns</h2><div class="body"><ul class="ul"><li class="li"><p class="p">ICMP_ECHO_OK - Indicates the query request was successfully sent.</p>
</li>
<li class="li"><p class="p">ICMP_ECHO_RESULT - The query request was unsuccessfully sent, which results in an error code (interface not ready for transmission, allocation error, etc.).</p>
</li>
</ul>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="remarks"><h2 class="title topictitle2" id="ariaid-title6">Remarks</h2><div class="body"><p class="p">The data buffer that's passed as part of the callback routine is no longer available after the callback routine returns control.</p>
<p class="p">This routine is more generic than TCPIP_ICMP_EchoRequestSend() and is preferred.</p>
<p class="p">The user has to enforce the fact that the "identifier" field has to be unique per (destination address, source address) pair.</p>
<p class="p">Currently there could be only one ping/echo request active at a time. If another echo request is active, a ICMP_ECHO_BUSY code will be returned.</p>
<p class="p">Once the callback notification occurs, the echo request is completed and the <em class="ph i">icmpHandle</em> is invalidated.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="example"><h2 class="title topictitle2" id="ariaid-title7">Example</h2><div class="body"><pre class="pre codeblock"><button title="Copy Code" class="copy-code" onclick="cpy('d40546e67', this);">Copy</button><code id="d40546e67" content="uint8_t  myDataBuffer[200];     // buffer for the ping data&#xD;&#xA;void EchoCallback(TCPIP_ICMP_ECHO_REQUEST* pReqData, TCPIP_ICMP_REQUEST_HANDLE icmpHandle, TCPIP_ICMP_ECHO_REQUEST_RESULT result);    // callback function to be called&#xD;&#xA;&#xD;&#xA;TCPIP_ICMP_ECHO_REQUEST myEchoRequest;&#xD;&#xA;myEchoRequest.netH  = 0;&#xD;&#xA;myEchoRequest.targetAddr  = 0xc0a00101;&#xD;&#xA;myEchoRequest.sequenceNumber = 1;&#xD;&#xA;myEchoRequest.identifier     = 0x1234;&#xD;&#xA;myEchoRequest.pData          = myDataBuffer;&#xD;&#xA;myEchoRequest.dataSize       = sizeof(myDataBuffer);&#xD;&#xA;myEchoRequest.callback       = EchoCallback;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;if(TCPIP_ICMP_EchoRequest(&amp;myEchoRequest, 0) == ICMP_ECHO_OK )&#xD;&#xA;{&#xD;&#xA;    // successfully sent the ICMP request&#xD;&#xA;    //&#xD;&#xA;    // EchoCallback() will be called and data can be examined&#xD;&#xA;}&#xD;&#xA;else&#xD;&#xA;{&#xD;&#xA;    // process the error&#xD;&#xA;}&#xD;">uint8_t  myDataBuffer[200];     // buffer for the ping data&#xD;
void EchoCallback(TCPIP_ICMP_ECHO_REQUEST* pReqData, TCPIP_ICMP_REQUEST_HANDLE icmpHandle, TCPIP_ICMP_ECHO_REQUEST_RESULT result);    // callback function to be called&#xD;
&#xD;
TCPIP_ICMP_ECHO_REQUEST myEchoRequest;&#xD;
myEchoRequest.netH  = 0;&#xD;
myEchoRequest.targetAddr  = 0xc0a00101;&#xD;
myEchoRequest.sequenceNumber = 1;&#xD;
myEchoRequest.identifier     = 0x1234;&#xD;
myEchoRequest.pData          = myDataBuffer;&#xD;
myEchoRequest.dataSize       = sizeof(myDataBuffer);&#xD;
myEchoRequest.callback       = EchoCallback;&#xD;
&#xD;
&#xD;
if(TCPIP_ICMP_EchoRequest(&amp;myEchoRequest, 0) == ICMP_ECHO_OK )&#xD;
{&#xD;
    // successfully sent the ICMP request&#xD;
    //&#xD;
    // EchoCallback() will be called and data can be examined&#xD;
}&#xD;
else&#xD;
{&#xD;
    // process the error&#xD;
}&#xD;</code></pre></div>
</div>
</body>
</html>