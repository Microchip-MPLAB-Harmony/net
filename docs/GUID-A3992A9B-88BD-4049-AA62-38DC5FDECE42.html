<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="_tag_TCPIP_MAC_PACKET Structure" />
<meta name="DC.relation" scheme="URI" content="GUID-0C1AF471-66D4-472F-84AF-212E9E18B21D.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="-tag-tcpip-mac-packet-structure" />
<link rel="stylesheet" type="text/css" href="stylesheets/commonltr.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<link rel="stylesheet" type="text/css" href="./stylesheets/common-extended.css" /><title>_tag_TCPIP_MAC_PACKET Structure</title>
<meta name="Microsoft.Help.Id" content="GUID-B1AF6B2B-BC62-4D92-B329-A50140DF3437--tag-tcpip-mac-packet-structure" />
<meta name="Microsoft.Help.TocParent" content="GUID-B1AF6B2B-BC62-4D92-B329-A50140DF3437" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLABÂ® Harmony TCP/IP Library Reference A 10/2021" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
        function cpy(id, button) {
        
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                    button.textContent = "Copy";
                    button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
              console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
        }
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-A3992A9B-88BD-4049-AA62-38DC5FDECE42"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style></head>
<body id="-tag-tcpip-mac-packet-structure">
<h1 class="title topictitle1" id="ariaid-title1">_tag_TCPIP_MAC_PACKET Structure</h1><div class="body"></div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-0C1AF471-66D4-472F-84AF-212E9E18B21D.html">MAC Driver Module</a></div>
</div>
</div><div class="topic nested1" aria-labelledby="ariaid-title2" id="c"><h2 class="title topictitle2" id="ariaid-title2">C</h2><div class="body"><pre class="pre codeblock"><button title="Copy Code" class="copy-code" onclick="cpy('d72376e21', this);">Copy</button><code id="d72376e21" content="struct _tag_TCPIP_MAC_PACKET {&#xD;&#xA;struct _tag_TCPIP_MAC_PACKET* next;&#xD;&#xA;struct _tag_TCPIP_MAC_PACKET* pkt_next;&#xD;&#xA;TCPIP_MAC_PACKET_ACK_FUNC ackFunc;&#xD;&#xA;const void* ackParam;&#xD;&#xA;TCPIP_MAC_DATA_SEGMENT* pDSeg;&#xD;&#xA;uint8_t* pMacLayer;&#xD;&#xA;uint8_t* pNetLayer;&#xD;&#xA;uint8_t* pTransportLayer;&#xD;&#xA;uint16_t totTransportLen;&#xD;&#xA;uint16_t pktFlags;&#xD;&#xA;uint32_t tStamp;&#xD;&#xA;const void* pktIf;&#xD;&#xA;int16_t ackRes;&#xD;&#xA;union {&#xD;&#xA;    uint16_t pktClientData[3];&#xD;&#xA;    struct {&#xD;&#xA;    uint16_t ipv4PktData;&#xD;&#xA;    uint16_t ipv6PktData;&#xD;&#xA;    uint16_t modPktData;&#xD;&#xA;    };&#xD;&#xA;};&#xD;&#xA;uint8_t pktPriority;&#xD;&#xA;uint32_t pktClientLoad[];&#xD;&#xA;};&#xD;">struct _tag_TCPIP_MAC_PACKET {&#xD;
struct _tag_TCPIP_MAC_PACKET* next;&#xD;
struct _tag_TCPIP_MAC_PACKET* pkt_next;&#xD;
TCPIP_MAC_PACKET_ACK_FUNC ackFunc;&#xD;
const void* ackParam;&#xD;
TCPIP_MAC_DATA_SEGMENT* pDSeg;&#xD;
uint8_t* pMacLayer;&#xD;
uint8_t* pNetLayer;&#xD;
uint8_t* pTransportLayer;&#xD;
uint16_t totTransportLen;&#xD;
uint16_t pktFlags;&#xD;
uint32_t tStamp;&#xD;
const void* pktIf;&#xD;
int16_t ackRes;&#xD;
union {&#xD;
    uint16_t pktClientData[3];&#xD;
    struct {&#xD;
    uint16_t ipv4PktData;&#xD;
    uint16_t ipv6PktData;&#xD;
    uint16_t modPktData;&#xD;
    };&#xD;
};&#xD;
uint8_t pktPriority;&#xD;
uint32_t pktClientLoad[];&#xD;
};&#xD;</code></pre></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title3" id="description"><h2 class="title topictitle2" id="ariaid-title3">Description</h2><div class="body"><p class="p">MAC Packet.</p>
<p class="p">Structure of a packet transferred with the MAC. This is the structure used for both TX and RX. See the description of each individual field.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="members"><h2 class="title topictitle2" id="ariaid-title4">Members</h2><div class="body">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d72376e41"><span>Members</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d72376e43"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>next</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Multi-packet/queuing support. This field is used for chaining/queuing packets.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>pkt_next</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Multi-packet/queuing support. This field is used for chaining packet fragments, etc.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>ackFunc</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Packet acknowledgment function. On TX: A stack module owns the packet. Once the MAC is done transmitting the packet (success or failure) it has to set an appropriate acknowledge result in the ackRes field ( a TCPIP_MAC_PKT_ACK_RES) adjust some packet flags (see TCPIP_MAC_PKT_FLAG_QUEUED) and call the packet acknowledge function (ackFunc). This call informs the packet owner that the MAC is done with using that packet. It is up to the implementation what action the ackFunc takes: reuse, free, discard the packet or if some of the above steps are included in the ackFunc itself. On RX: The packet is under the MAC control and it's passed to the stack when it contains valid data. Once the recipient of the packet (IP, ICMP, UDP, TCP, etc.) is done with the packet processing it has to set an appropriate acknowledge result in the ackRes field ( a TCPIP_MAC_PKT_ACK_RES) adjust some packet flags (see TCPIP_MAC_PKT_FLAG_QUEUED) and call the packet acknowledge function (ackFunc). This call informs the packet owner (the MAC) that the processing of the packet is completed. It is up to the implementation what action the ackFunc takes: reuse, free, discard the packet or if some of the above steps are included in the ackFunc itself.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>ackParam</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Associated acknowledgment parameter to be used when ackFunc is called. For TX packets: this is a client supplied parameter and is not used by the MAC driver. For RX: If the MAC owns the RX packet then the MAC driver can use this field for further dispatching in the MAC driver owned acknowledgment function.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>pDSeg</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Data (root) segment associated to this packet. It is up to the design if the root data segment associated with a packet is contiguous in memory with the packet itself. It can be 0 if the packet has no associated data.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>pMacLayer</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Pointer to the MAC frame. On TX: the sending higher layer protocol updates this field. On RX: the MAC driver updates this field before handing over the packet. (MCHP TCP/IP stack note: The packet allocation function update this field automatically).</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>pNetLayer</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Pointer to the network layer data. On TX: the sending higher layer protocol updates this field. The MAC driver shouldn't need this field. On RX: the MAC driver updates this field before handing over the packet. (MCHP TCP/IP stack note: The packet allocation function updates this field automatically. But not for IPv6!).</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>pTransportLayer</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Pointer to the transport layer. The MAC driver does not use this field.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>totTransportLen</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Total length of the transport layer. The MAC driver shouldn't need this field.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>pktFlags</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>TCPIP_MAC_PACKET_FLAGS associated packet flags. On TX: the MAC driver has to set: TCPIP_MAC_PKT_FLAG_QUEUED - if the driver needs to queue the packet On RX: the MAC driver updates this field before handing over the packet. Flags that the MAC driver has to set/clear: TCPIP_MAC_PKT_FLAG_RX and TCPIP_MAC_PKT_FLAG_UNICAST, TCPIP_MAC_PKT_FLAG_BCAST and TCPIP_MAC_PKT_FLAG_MCAST TCPIP_MAC_PKT_FLAG_QUEUED TCPIP_MAC_PKT_FLAG_SPLIT</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>tStamp</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Time stamp value. Statistics, info. On TX: the sending higher layer protocol updates this field. The MAC driver shouldn't need this field On RX: the MAC driver updates this field before handing over the packet.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>pktIf</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>The packet interface. On TX: the sending higher layer protocol updates this field. The MAC driver doesn't use this field. On RX: the receiving higher level protocol updates this value. The MAC driver doesn't use this field.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>ackRes</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>A TCPIP_MAC_PKT_ACK_RES code associated with the packet. On TX: The MAC driver sets this field when calling the packet ackFunc. On RX: The higher level protocol which is the recipient of the packet sets this field when calling the packet ackFunc.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>pktPriority</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Priority associated with the packet. On TX: The MAC driver use this field to transmit packet using priority queues. On RX: The MAC driver inform stack about the priority of the packet received.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e41 "><span>pktClientLoad<span class="xref"></span></span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d72376e43 "><span>Additional client packet payload, variable packet data. Ignored by the MAC driver.</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="remarks"><h2 class="title topictitle2" id="ariaid-title5">Remarks</h2><div class="body"><p class="p">Specific TCP/IP stack implementations might offer packet support functions to assist in driver development. (For the MCHP TCP/IP stack see tcpip_packet.h).</p>
<p class="p">Since the packets may be dynamically allocated, an acknowledge function can result in data deallocation (blocking). Therefore, the acknowledgment function should NOT be called from within an interrupt context.</p>
</div>
</div>
</body>
</html>